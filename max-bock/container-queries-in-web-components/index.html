<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Container Queries in Web Components</title>
	<link rel="stylesheet" href="/11ty-test/css/style.css" />
</head>
<body>
	
		<nav class="background-primary">
			<a href="/">Steph&#39;s Favorite RSS</a>
			<small><em>Fetching results since Feb 25, 2021</em></small>
		</nav>
	

	<header >
			
		<div class="container container--item">
				<small><strong>May 15, 2021</strong></small>

				<h1>Container Queries in Web Components</h1>
				<p class="header-meta">

<span class="category"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false" aria-hidden="true" width="24"><defs/><path d="M0 0h24v24H0V0z" fill="none"/><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg> <a href="/category/css/">CSS</a></span>

 <a href="/max-bock/">All from Max Böck</a> <strong><a href="https://mxb.dev/blog/container-queries-web-components/">View <span class="inclusively-hidden">Container Queries in Web Components</span> on mxb.dev</a></strong></p>
			
		</div>
	</header>
	<main>
	<article class="container item-article background-light">
<p class="lead">Container Queries are one of the most anticipated new features in CSS. I recently got a chance to play with them a bit and take the new syntax for a spin.</p>
<p>I came up with this demo of a book store. Each of the books is draggable and can be moved to one of three sections, with varying available space. Depending on where it is placed, different styles will be applied to the book. The <a href="https://codepen.io/mxbck/pen/XWMrMOp">full source code</a> is up on Codepen. Here’s how it looks:</p>
<div class="extend">
    <video width="960" style="margin:0 auto; border: 1px solid var(--color-border);" preload="" controls="">
        <source src="https://res.cloudinary.com/mxb/video/upload/q_auto/v1621003114/bookstore_nnn2vr.webm" type="video/webm">
        <source src="https://res.cloudinary.com/mxb/video/upload/q_auto/v1621003115/bookstore_kkpxmt.mp4" type="video/mp4">
    </video>
</div>
<div class="callout callout--warning"><span class="callout__icon"><svg class="icon icon--warning" role="img" aria-hidden="true" width="24" height="24"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/icons.sprite.svg#icon-warning"></use></svg></span><div class="callout__content"><p>This demo currently only works in <a href="https://www.google.com/chrome/canary/">Chrome Canary</a>. Download the latest version, then enable Container Queries under <em>chrome://flags</em> to see them in action.</p></div></div>
<h2 id="h-here%E2%80%99s-what%E2%80%99s-going-on"><a class="heading-anchor" href="#h-here%E2%80%99s-what%E2%80%99s-going-on" aria-hidden="true">#</a> Here’s what’s going on</h2>
<p>Each of these books is a custom element, or “web component”. They each contain a cover image, a title and an author. In markup they look like this:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>book-element</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ba423d<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cover<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/books/1984.avif<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cover by shepard fairey<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1984<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>George Orwell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>book-element</span><span class="token punctuation">></span></span></code></pre>
<p>This then gets applied to a template which defines the internal Shadow DOM of the component. The <code>&lt;slot&gt;</code> elements in there will get replaced by the actual content we’re passing in.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>book-template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>book<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>front<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>meta<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>Alright, nothing too fancy yet, just some basic structure.</p>
<p>The magic happens when we apply some internal styling to this. Everything inside that <code>&lt;style&gt;</code> tag will be scoped to the component - and since styles can not leak out of the shadow DOM and we can’t (easily) style its contents from the outside, we have real component encapsulation.</p>
<p>Container Queries are one of the last few missing puzzle pieces in component-driven design. They enable us to give components <strong>intrinsic</strong> styles, meaning they can adapt themselves to whatever surroundings they are placed in.</p>
<p>The new key property there is <code>contain</code> - it lets us define an element as a container to compare container queries against. A value of <code>layout</code> indicates that nothing outside the element may affect its internal layout and vice versa.</p>
<p>This allows the browser to optimize the number of calculations necessary to create the page layout. By adding <code>inline-size</code> to the rule, we also tell the browser to respond to changes in width of the container.</p>
<p><strong>UPDATE:</strong> as of Chrome Canary 93.0.4522, the <code>contain</code> property also needs the <code>style</code> value for container queries to work properly. It indicates that any styling that <em>could</em> affect more than the element and its children doesn’t escape the container. The reasoning behind that is documented <a href="https://github.com/w3c/csswg-drafts/issues/6213">in this issue</a> by the CSS working group.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>book-template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>    <span class="token comment">/* Use Web Component as the Layout Container */</span><br>    <span class="token selector">:host</span> <span class="token punctuation">{</span><br>        <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span><br>        <span class="token property">contain</span><span class="token punctuation">:</span> layout inline-size style<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br>    ...<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>In the bookstore demo, I created three variants that depend on the width of the component’s <code>:host</code> (which translates to the <code>&lt;book-element&gt;</code> itself). I’ve omitted some of the styling for brevity here, but this part is where we define the multi-column or 3D book styles.</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Small Variant: Simple Cover + Title */</span><br><span class="token atrule"><span class="token rule">@container</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 199px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><br>    <span class="token selector">.book</span> <span class="token punctuation">{</span><br>        <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token comment">/* Medium Variant: Multi-Column, with Author */</span><br><span class="token atrule"><span class="token rule">@container</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 399px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><br>    <span class="token selector">.book</span> <span class="token punctuation">{</span><br>        <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span><br>        <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> 1fr 1fr<span class="token punctuation">;</span><br>        <span class="token property">gap</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token comment">/* Large Variant: 3D Perspective */</span><br><span class="token atrule"><span class="token rule">@container</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><br>    <span class="token selector">.book</span> <span class="token punctuation">{</span><br>        <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><br>        <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span><br>        <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>-25deg<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>By adding <a href="https://github.com/bevacqua/dragula">Dragula.js</a> to enable drag-and-drop functionality, we can then move the individual components around. As soon as they’re moved to a different section in the DOM, its internal styles are re-calculated to match the new environment, and the corresponding CSS block is applied. Magic!</p>
<h2 id="h-the-bento-box-idea"><a class="heading-anchor" href="#h-the-bento-box-idea" aria-hidden="true">#</a> The Bento Box Idea</h2>
<p>Now theoretically, we could have achieved a similar effect by using the cascade itself. We could for example apply the 3D styles to all <code>.book</code>s inside <code>.stage</code>. But that would have some problems:</p>
<ul>
<li>it wouldn’t be responsive - if <code>.stage</code> ever gets too narrow, it would break</li>
<li>it would create an unwanted dependency context between parent and child</li>
<li>it would break component encapsulation and mix layout with content styles</li>
</ul>
<p>It’s generally a <a href="https://mxb.dev/blog/the-css-mindset/">good idea</a> in CSS to separate “layout” from “content” components and let each handle their own specific areas of responsibility. I like to think of Japanese bento boxes as a metaphor for this: a container divided into specific sections that can be filled with anything.</p>
<p>For example, the layout for our bookstore looks like this:</p>
<figure class="extend">
    <img src="https://res.cloudinary.com/mxb/image/upload/v1621005967/grid_sa0gt0.png" style="border: 1px solid var(--color-border);" alt="layout schema for the bookstore with three main content sections">
</figure>
<p>It’s a grid divided into three sections, the middle one containing a nested flexible grid itself.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>itemlist<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cart<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<pre class="language-css"><code class="language-css"><span class="token comment">/* main layout sections */</span><br><span class="token selector">.stage,<br>.content,<br>.cart</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--spacing<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/* nested sub-grid */</span><br><span class="token selector">.itemlist</span> <span class="token punctuation">{</span><br>    <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span><br>    <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fill<span class="token punctuation">,</span> <span class="token function">minmax</span><span class="token punctuation">(</span>200px<span class="token punctuation">,</span> 1fr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token property">gap</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--spacing<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/* desktop layout */</span><br><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 1024px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span><br>    <span class="token selector">.layout</span> <span class="token punctuation">{</span><br>        <span class="token property">display</span><span class="token punctuation">:</span>grid<span class="token punctuation">;</span><br>        <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span><br>        <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> 480px 1fr 130px<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The parts of the layout are only concerned with the alignment and dimensions of boxes. They have no effect whatsoever on their children other than giving them a certain amount of space to fill. Just like a bento box, it doesn’t care what we put into it, so we could easily re-use the layout for a completely different product. It is <strong>content-agnostic</strong>.</p>
<p>That’s why Container Queries pair so well with Web Components. They both offer ways to encapsulate logic to build smart, independent building blocks. Once they’re defined, they can be used anywhere.</p>
<p>Container Queries bring us one step closer to <a href="https://aneventapart.com/news/post/designing-intrinsic-layouts-aea-video">“Intrinsic Layouts”</a> and a future of truly independent, component-driven design. Exciting stuff ahead!</p>
<h2 id="h-further-reading"><a class="heading-anchor" href="#h-further-reading" aria-hidden="true">#</a> Further Reading</h2>
<ul>
<li><a href="https://www.miriamsuzanne.com/2021/05/02/container-queries/">Container Queries Explainer &amp; Proposal</a> - Miriam Suzanne</li>
<li><a href="https://www.sarasoueidan.com/blog/component-level-art-direction-with-container-queries-and-picture/">Component-level art direction with CSS Container Queries</a> - Sara Soueidan</li>
<li><a href="https://github.com/w3c/csswg-drafts/issues/5889">Discussion about Container Queries in srcset and sizes</a> - CSSWG on Github</li>
</ul>
</article>
	</main>
	<footer class="background-primary">
		<p><a href="https://github.com/5t3ph/eleventy-rss-reader">eleventy-rss-reader</a> created by <a href="https://twitter.com/5t3ph">Stephanie Eckles</a></p>
	</footer>

	
	<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
	
</body>
</html>